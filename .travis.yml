---
language: python

cache:
  directories:
    - /home/travis/.rvm
    - /home/travis/.cache/pip
    - /home/travis/virtualenv

python: 3.6

# Install ansible
install:
  - ln -s $( basename $PWD ) ../locp.cassandra
  - bundle install
  - pip install -Ur requirements.txt
  - pip freeze

script:
  - bundle exec travis lint --skip-completion-check --exit-code
  - bundle exec rubocop -ES
  - molecule test --destroy never
  - docker stats --no-stream
  - docker top node0
  - docker top node1
  - docker top node2
  - docker top node3
  - molecule test --scenario-name combine_cluster --destroy never

notifications:
  webhooks:
    urls:
      - https://galaxy.ansible.com/api/v1/notifications/
      - https://webhooks.gitter.im/e/eee7ec1dcb85c454573a
    on_success: change  # options: [always|never|change] default: always
    on_failure: always  # options: [always|never|change] default: always
    on_start: never     # options: [always|never|change] default: always

jobs:
  include:
    - env: DOCKER_COMMAND="/usr/sbin/init"
           DOCKER_IMAGE="centos"
           DOCKER_TAG="7"
    - env: DOCKER_COMMAND="/usr/sbin/init"
           DOCKER_IMAGE="centos"
           DOCKER_TAG="8"
    - env: DOCKER_IMAGE="debian"
           DOCKER_TAG="9"
    - env: DOCKER_IMAGE="debian"
           DOCKER_TAG="10"
    - env: DOCKER_COMMAND="/usr/sbin/init"
           DOCKER_IMAGE="fedora"
           DOCKER_TAG="30"
    - env: DOCKER_COMMAND="/usr/sbin/init"
           DOCKER_IMAGE="fedora"
           DOCKER_TAG="31"
    - env: DOCKER_IMAGE="ubuntu"
           DOCKER_TAG="18.04"
    - env: DOCKER_IMAGE="ubuntu"
           DOCKER_TAG="20.04"
